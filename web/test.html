<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Basic template • Pico.css</title>
    <meta
      name="description"
      content="A basic custom template for Pico using only CSS custom properties (variables). Built with Pico CSS."
    />
    <link rel="shortcut icon" href="https://picocss.com/favicon.ico" />
    <link rel="canonical" href="https://picocss.com/examples/basic-template/" />

    <!-- Pico.css -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" />

    <!-- Custom template-->
    <link rel="stylesheet" href="css/custom.css" />
    <style>
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .container {
            margin-top: auto; /* Push the container to the bottom */
        }
    </style>
  </head>

  <body>
    <!-- Header -->
    <header class="container">
      <hgroup>
        <h1>In Browser Image Recognition</h1>
        <h2>This image recognition model is running in your browser!</h2>
      </hgroup>
    </header>
    <!-- ./ Header -->

    <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"></script>
    <script src="model.js"></script>

<div class="container">
        <h2>Image to Matrix Converter</h2>
        <form id="uploadForm">
            <input type="file" id="imageInput" accept="image/*" />
            <button type="button" onclick="convertImage()">Convert</button>
        </form>
        <div id="result"></div>
    </div>

    <script>
        function convertImage() {
            var input = document.getElementById('imageInput');
            var resultDiv = document.getElementById('result');

            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    var img = new Image();
                    img.src = e.target.result;

                    img.onload = function () {
                        var canvas = document.createElement('canvas');
                        var ctx = canvas.getContext('2d');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);

                        // Get the pixel data
                        var imageData = ctx.getImageData(0, 0, img.width, img.height).data;
                        var pixels = img.width * img.height;
                        
                        // Convert pixel data to a three-channel matrix
                        var matrix = [];
                        var x = 0;
                        for (var i = 0; i < imageData.length; i += 4) {
                            //var rgbValues = [imageData[i], imageData[i + 1], imageData[i + 2]];
                            matrix.push(imageData[i] == 255 ? 244: imageData);
                            matrix.push(imageData[i+1] == 255 ? 244: imageData);
                            matrix.push(imageData[i+2] == 255 ? 244: imageData);
                            x += 1;
                        }

                        var dims = [x, imageData.length, matrix.length, matrix[0].length]
                        // Convert pixel data to a matrix (for simplicity, we'll just print the first pixel's RGB values)
                        // var matrix = [imageData.slice(10)];
                        
                        console.log(run(matrix, img.height, img.width))

                        resultDiv.innerHTML = '<p>Matrix:</p><pre>' + JSON.stringify(dims, null, 2) + '</pre>';
                    };
                };

                reader.readAsDataURL(input.files[0]);
            } else {
                resultDiv.innerHTML = '<p>Please select an image.</p>';
            }
        }
    </script>

    <!-- Footer -->
    <footer class="container">
      <small
        >Built with <a href="https://picocss.com">Pico</a> •
        <a href="https://github.com/picocss/examples/blob/master/v1-basic-template/"
          >Source code</a
        ></small
      >
    </footer>
    <!-- ./ Footer -->
  </body>
</html>
